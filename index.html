<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunny Cloudy SoCal</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Oswald:wght@400;700&family=Playfair+Display:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- CSS Modules -->
    <!-- Base Styles -->
    <link rel="stylesheet" href="css/base/variables.css">
    <link rel="stylesheet" href="css/base/typography.css">
    <link rel="stylesheet" href="css/base/utilities.css">
    <!-- Section Styles -->
    <link rel="stylesheet" href="css/sections/hero.css">
    <link rel="stylesheet" href="css/sections/intro.css">
    <link rel="stylesheet" href="css/sections/intro_hook.css">
    <link rel="stylesheet" href="css/sections/cloud-wall.css">
    <link rel="stylesheet" href="css/sections/cloud-playground.css">
    <link rel="stylesheet" href="css/sections/climate-lab.css">
    <link rel="stylesheet" href="css/sections/mechanism.css">
    <link rel="stylesheet" href="css/sections/city-playground.css">
    <link rel="stylesheet" href="css/sections/footer.css">
    <link rel="stylesheet" href="css/sections/realtime_clouds.css">

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Mapbox -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />

    <!-- New Component Styles -->
    <link rel="stylesheet" href="css/components/navigator.css">
</head>

<body>
    <!-- SECTION NAVIGATOR -->
    <nav id="section-navigator"></nav>

    <!-- INTRO HOOK (Overlay) -->
    <!-- INTRO HOOK (Overlay) -->
    <div id="intro-hook" class="intro-overlay">
        <!-- Close/Skip Button -->
        <div id="intro-skip-btn" class="intro-close-btn">‚úï</div>

        <!-- Story Progress Bars (Now 5 Segments) -->
        <div class="story-progress-container">
            <div class="story-progress-bar active">
                <div class="progress-fill"></div>
            </div> <!-- 1: Question -->
            <div class="story-progress-bar">
                <div class="progress-fill"></div>
            </div> <!-- 1.5: Word Cloud -->
            <div class="story-progress-bar">
                <div class="progress-fill"></div>
            </div> <!-- 2: Fantasy -->
            <div class="story-progress-bar">
                <div class="progress-fill"></div>
            </div> <!-- 3: Reality (Fog) -->
            <div class="story-progress-bar">
                <div class="progress-fill"></div>
            </div> <!-- 4: Article (Card) -->
        </div>

        <div class="intro-slide active" data-slide="1">
            <div class="story-bg-gradient"></div>
            <div class="story-ui-header">
                <div class="story-user">
                    <div class="story-avatar"
                        style="background-image: url('assets/wave.webp'); background-size: cover;"></div>
                    <span>WAVS</span>
                    <span class="story-time">2h</span>
                </div>
            </div>

            <div class="story-sticker-container question-card">
                <div class="question-header-avatar"
                    style="background-image: url('assets/wave.webp'); background-size: cover;">
                </div>
                <h1 class="story-question">If gives one word to describe SoCal, what would it be?</h1>
                <div class="story-input-wrapper">
                    <input type="text" id="intro-word-input" placeholder="Type something..." autocomplete="off">
                    <!-- Hidden button for enter key functionality if needed, visually removed to match design -->
                    <button id="intro-word-submit" style="display:none;"></button>
                </div>
            </div>

            <div class="story-chips-container">
                <div class="story-chip" onclick="app.introHook.fillInput('Sunshine')">Sunshine ‚òÄÔ∏è</div>
                <div class="story-chip" onclick="app.introHook.fillInput('Palm Trees')">Palm Trees üå¥</div>
                <div class="story-chip" onclick="app.introHook.fillInput('Surfing')">Surfing üèÑ‚Äç‚ôÇÔ∏è</div>
                <div class="story-chip" onclick="app.introHook.fillInput('Hollywood')">Hollywood üé¨</div>
            </div>
        </div>

        <!-- Slide 1.5: Collective Mindset (Word Cloud Viz) -->
        <div class="intro-slide" data-slide="1.5">
            <div class="story-bg-gradient"></div>
            <div class="hashtag-header">#SoCalMindset</div>
            <h2 class="viz-title">What everyone is saying</h2>
            <p class="viz-subtitle">Trending words from 24.5k locals</p>
            <div id="intro-word-cloud"></div>
        </div>

        <!-- Slide 2: The Fantasy (Sunny Image) -->
        <div class="intro-slide" data-slide="2">
            <div class="slide-bg-image" style="background-image: url('assets/sunny_beach.webp');"></div>

            <div class="insta-story-overlay">
                <!-- Header -->
                <div class="story-user-tag">
                    <div class="story-avatar-small"
                        style="background-image: url('assets/wave.webp'); background-size: cover;">
                    </div>
                    <div class="story-meta">
                        <div class="story-row-top">
                            <span class="story-username">WAVS</span>
                            <span class="story-time">16h</span>
                        </div>
                        <div class="story-music">
                            <span class="music-icon">üéµ</span>
                            <span class="music-text">Albert Hammond ¬∑ It Never Rains in Southern California</span>
                        </div>
                    </div>
                </div>

                <!-- Content Layer (Absolute Positioned via CSS) -->
                <div class="story-content-layer">
                    <!-- Location -->
                    <div class="story-sticker location-sticker pill-white">
                        <span class="loc-icon" style="color: #e1306c;">üìç</span> LA JOLLA
                    </div>

                    <!-- Time -->
                    <div class="story-sticker time-sticker digital-clock">
                        <div class="time-group">
                            <span class="time-digit">0</span>
                            <span class="time-digit">4</span>
                        </div>
                        <div class="time-group">
                            <span class="time-digit">0</span>
                            <span class="time-digit">2</span>
                        </div>
                        <div class="time-ampm-box">PM</div>
                    </div>

                    <!-- Hashtag -->
                    <div class="story-sticker hashtag-sticker pill-white">
                        #SUNNYSANDIEGO ‚òÄÔ∏è
                    </div>

                    <!-- Main Text -->
                    <div class="story-main-text left-align">
                        SEEMS
                        <span class="lyric-small">IT NEVER RAINS</span>
                        IN
                        <span class="lyric-small">SOUTHERN</span>
                        <span class="lyric-small">CALIFORNIA</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3: Reality Check (Fog Phase) -->
        <div class="intro-slide" data-slide="3">
            <!-- 1. Background Image (Revealed when fog scratched) -->
            <div class="slide-bg-image"
                style="background-image: url('data/goes_images_monthly/2023-03/20230319_2202.webp');"></div>

            <!-- 2. Fog Layer (Middle) -->
            <div id="intro-fog-layer" class="fog-overlay" style="z-index: 5;"></div>

            <!-- 3. Fog Text Overlay (Top) - Fades out on scratch -->
            <div class="insta-story-overlay fog-text-overlay" style="z-index: 10;">
                <div class="story-user-tag">
                    <div class="story-avatar-small"
                        style="background-image: url('assets/wave.webp'); background-size: cover;"></div>
                    <div class="story-meta">
                        <div class="story-row-top">
                            <span class="story-username">WAVS</span>
                            <span class="story-time">1h</span>
                        </div>
                        <div class="story-music">
                            <span class="music-icon">üéµ</span>
                            <span class="music-text">Camila Cabello ¬∑ June Gloom</span>
                        </div>
                    </div>
                </div>

                <div class="story-content-layer">
                    <!-- Location -->
                    <div class="story-sticker location-sticker pill-white">
                        <span class="loc-icon" style="color: #8b5cf6;">üìç</span> La Jolla
                    </div>

                    <!-- Time -->
                    <div class="story-sticker time-sticker digital-clock">
                        <div class="time-group">
                            <span class="time-digit">0</span>
                            <span class="time-digit">9</span>
                        </div>
                        <div class="time-group">
                            <span class="time-digit">3</span>
                            <span class="time-digit">2</span>
                        </div>
                        <div class="time-ampm-box">AM</div>
                    </div>

                    <!-- Hashtag -->
                    <div class="story-sticker hashtag-sticker pill-white">
                        #JUNEGLOOM ‚òÅÔ∏è
                    </div>

                    <!-- Main Text -->
                    <div class="story-main-text left-align">
                        JUNE<br>
                        GLOOM,
                        <span class="lyric-small">TULE FOG</span>
                    </div>

                    <div class="swipe-hint-container">
                        <div id="intro-swipe-btn" class="swipe-hint">
                            <span class="scrub-icon">üëÜ</span> Scrub to remove fog
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: Real Story (Article Card) -->
        <div class="intro-slide" data-slide="4">
            <!-- Background Blur -->
            <div class="article-bg-blur"
                style="position:absolute; width:100%; height:100%; background-image: url('data/goes_images_monthly/2023-03/20230319_2202.webp'); background-size: cover; filter: blur(20px); opacity: 0.5;">
            </div>

            <!-- Article Card -->
            <div class="article-card" id="intro-article-card" style="z-index: 10; opacity: 1; transform: scale(1);">
                <div class="article-card-header">
                    <div class="story-avatar-small"
                        style="background-image: url('assets/wave.webp'); background-size: cover;"></div>
                    <span>WAVS</span>
                </div>
                <div class="article-thumbnail"
                    style="background-image: url('data/goes_images_monthly/2023-03/20230319_2202.webp');"></div>
                <div class="article-info">
                    <h3><span class="strike-through">Sunny</span> Cloudy SoCal</h3>
                    <p>Is SoCal really sunny?</p>
                    <p>Find out the truth behind the SoCal sunshine myth.</p>
                </div>
                <div class="article-cta">
                    Tap to Read Full Story &rarr;
                </div>
            </div>
        </div>
    </div>

    <!-- SECTION 1: HERO (Title & Hook) -->
    <section class="hero" id="hero-section">
        <!-- Replay Story Button -->
        <div id="replay-story-btn" class="story-replay-badge">
            <div class="story-avatar-tiny" style="background-image: url('assets/wave.webp');"></div>
            <span>Watch Story</span>
        </div>

        <div class="hero-grid" id="hero-grid">
            <!-- Grid of 100 images will be injected here by JS -->
        </div>

        <div class="hero-content">
            <h1 class="hero-title"><span class="strike-through">Sunny</span> Cloudy SoCal</h1> <br>
            <p class="hero-tagline">Is SoCal <em>really</em> sunny?</p><br>
            <p class="hero-subtitle">Visualizing 365 days of NOAA GOES-16 satellite imagery</p>
        </div>
        <canvas id="fog-overlay"></canvas>
        <div class="scroll-prompt">Scroll for Analysis</div>
    </section>


    <!-- INTRO: PART 1 HEADER -->
    <section id="part1-header" class="part-divider">
        <div class="part-number">01</div>
        <div class="part-content">
            <h2>I. The Satellite Records</h2>
            <p>Southern California is often marketed as a place with perfect weather. But for the millions of people
                living
                along the coast, it is frequently cloudy. To answer the question "Is SoCal really sunny?", we analyzed
                the actual weather patterns by processing 365 days of NOAA GOES-16 satellite imagery from 2023. </p>
        </div>
    </section>

    <!-- SECTION 2: CLOUD WALL (SCROLLYTELLING) -->
    <section id="cloud-wall-section" class="scrolly-container">
        <div class="sticky-viz">
            <div class="viz-header">
                <h2>2023 Cloud Calendar</h2>
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">Hover any day to see the satellite
                    view. Toggle modes below to compare times.</p>
                <div class="viz-controls">
                    <button class="viz-btn" data-mode="morning"
                        onclick="app.cloudWall.setView('morning')">Morning</button>
                    <button class="viz-btn" data-mode="afternoon"
                        onclick="app.cloudWall.setView('afternoon')">Afternoon</button>
                    <button class="viz-btn active" data-mode="both" onclick="app.cloudWall.setView('both')">Compare
                        Both</button>
                </div>
                <div class="viz-legend" style="margin-top:10px;">
                    <span>Clear</span>
                    <div class="gradient-bar"></div>
                    <span>Overcast</span>
                </div>
            </div>
            <div id="cloud-cal-grid"></div>
        </div>

        <div class="scroll-steps">
            <!-- Step 1 -->
            <div class="step" data-step="1">
                <div class="step-content">
                    <h3>The Morning Baseline</h3>
                    <p>This is the view from space at 8:00 AM each day. Contrary to the stereotype, perfectly clear
                        mornings are not that common. 55.07% of mornings in 2023 (201 out of 365 days) had over 50%
                        cloud cover.</p>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="step" data-step="2">
                <div class="step-content">
                    <h3>Winter Storms</h3>
                    <p>The year started with heavy storms. January through March 2023 saw historic rainfall and thick,
                        persistent clouds.</p>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="step" data-step="3">
                <div class="step-content">
                    <h3>"May Gray" Arrives</h3>
                    <p>In spring, the pattern changes. The marine layer forms more often, covering the coast in low
                        clouds.</p>
                </div>
            </div>

            <!-- Step 4 -->
            <div class="step" data-step="4">
                <div class="step-content">
                    <h3>Peak Gloom</h3>
                    <p>By June, the marine layer is thickest. For people living near the coast, the sun is often blocked
                        for weeks at a time.</p>
                </div>
            </div>

            <!-- Step 5 -->
            <div class="step" data-step="5">
                <div class="step-content">
                    <h3>Afternoon Clearing</h3>
                    <p>Switching to <strong>2:00 PM</strong> shows a different picture. As the land heats up, the clouds
                        usually evaporate. However, clouds still lingered in the afternoon 47.95% of the time in 2023.
                    </p>
                </div>
            </div>

            <!-- Step 6 -->
            <div class="step" data-step="6">
                <div class="step-content">
                    <h3>Second Summer</h3>
                    <p>True summer comes late. September and October are often the clearest, hottest months as dry
                        desert air pushes the clouds away.</p>
                </div>
            </div>

            <!-- Step 7 -->
            <div class="step" data-step="7">
                <div class="step-content">
                    <h3>Time Matters</h3>
                    <p>The time of day is just as important as the season. Try comparing the morning and afternoon views
                        to see how the cloud patterns change each day. </p>
                </div>
            </div>
        </div>
    </section>

    <!-- BRIDGE 1 -->
    <section class="prose-bridge">
        <h2>The Daily Rhythm</h2>
        <p>The yearly view shows us the overall trend, but it's better to see the daily reality more closely. To capture
            the day-to-day
            experience, we measured the <strong>daily average cloud fraction</strong>‚Äîthe percentage of pixels
            classified as cloudy‚Äîspecifically for the coastal region (32¬∞N to 35¬∞N). This tool lets you explore those
            daily patterns with a closer look.</p>
    </section>

    <!-- SECTION 3: CLOUD PLAYGROUND -->
    <section id="cloud-playground" class="full-screen-section">
        <div class="section-header">
            <h2>The Satellite Archive</h2>
            <p>Drag the scrubber to observe the daily cloud patterns across 2023, or play time-lapse videos to see how
                cloud cover changed over the course of a year.</p>
            <p>Tip: Click the "Deep Dive" button to explore more detailed cloud patterns in selected days.</p>
        </div>

        <!-- Master Timeline -->
        <div id="cp-timeline-container" style="width: 100%; max-width: 1200px; margin-bottom: 2rem;">
            <div class="timeline-label-row">
                <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                <span>Jul</span><span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span>
            </div>
            <div id="cp-master-timeline">
                <div class="timeline-cursor" id="cp-cursor"></div>
            </div>
        </div>

        <div class="cp-dashboard">
            <!-- Left: Visualization -->
            <div class="cp-preview panel">
                <div class="cp-image-container" id="cp-img-container">
                    <img id="cp-image" src="" alt="Satellite View">
                    <img id="cp-image-compare" src="" alt="Comparison View" class="hidden"
                        style="position:absolute; top:0; left:50%; width:50%; height:100%; object-fit:cover; border-left:1px solid white;">

                    <div class="cp-overlay-label" id="overlay-label">08:00 AM</div>
                    <div class="cp-overlay-label hidden" id="overlay-label-compare" style="right: auto; left: 10px;">
                        02:00 PM</div>
                </div>

                <div class="cp-stats-row">
                    <div class="cp-stat-group">
                        <div class="cp-stat-title" id="cp-date-display">Jan 1, 2023</div>
                        <div class="cp-stat-value" id="cp-mood-display">Partly Cloudy</div>
                    </div>
                    <div class="cp-meter-group">
                        <label>Cloud Cover</label>
                        <div class="progress-bar">
                            <div id="cp-progress-fill" style="width: 45%;"></div>
                        </div>
                        <span id="cp-progress-text">45%</span>
                    </div>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="cp-controls panel">

                <div id="view-timeline" class="control-view">

                    <!-- Smart Navigation Row -->
                    <div class="control-group nav-row" style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <button id="btn-prev" class="nav-btn" onclick="app.playground.step(-1)" style="flex:1;">‚Üê
                            Prev</button>
                        <button id="btn-deep-jump" class="action-btn" onclick="app.playground.jumpToNextSpecial()"
                            style="flex:2; margin:0; background:transparent; border:1px solid #f4d03f; color:#886f00;">
                            Jump to Deep Dive ‚ûú
                        </button>
                        <button id="btn-next" class="nav-btn" onclick="app.playground.step(1)" style="flex:1;">Next
                            ‚Üí</button>
                    </div>

                    <!-- Timelapse Controls & Speed -->
                    <div class="control-group"
                        style="margin-bottom: 1.5rem; display:flex; justify-content:center; align-items:center; gap: 1rem;">
                        <button id="btn-timelapse" class="timelapse-btn" onclick="app.playground.toggleTimelapse()"
                            style="height: 32px; padding: 0 1.5rem; font-size: 0.8rem; flex: 0 1 auto; white-space: nowrap;">
                            <span class="icon">‚ñ∂</span> Play Year
                        </button>

                        <!-- Global Speed Control -->
                        <div
                            style="display:flex; align-items:center; gap:0.5rem; background:rgba(255,255,255,0.5); padding:0 12px; border-radius:16px; border:1px solid #eee; height: 32px;">
                            <label style="font-size:0.7rem; color:#888; font-weight:600; text-align:left;">SPEED</label>
                            <input type="range" id="speed-slider" min="0.5" max="2" step="0.5" value="1"
                                oninput="app.playground.updateSpeed(this.value)"
                                style="width: 60px; height: 4px; accent-color: #f4d03f; cursor:pointer;">
                            <span id="speed-val"
                                style="font-size:0.7rem; color:#444; width:24px; text-align:right;">1x</span>
                        </div>
                    </div>

                    <!-- View Mode Toggles -->
                    <div class="control-group">
                        <label>View Mode</label>
                        <div class="mode-toggles">
                            <button class="toggle-btn active" id="btn-morning"
                                onclick="app.playground.setMode('morning')">08:00 AM</button>
                            <button class="toggle-btn" id="btn-afternoon"
                                onclick="app.playground.setMode('afternoon')">02:00 PM</button>
                            <button class="toggle-btn" id="btn-compare"
                                onclick="app.playground.setMode('compare')">Compare</button>
                            <button class="toggle-btn hidden" id="btn-deep-dive"
                                style="border-color:#f4d03f; color:#b7950b;"
                                onclick="app.playground.setMode('deepdive')">‚òÖ Deep Dive</button>
                        </div>
                    </div>

                    <!-- Deep Dive Player (Dynamic) -->
                    <div id="deep-dive-panel" class="hidden">
                        <div class="header-row">
                            <label>Deep Dive Player</label>
                            <button class="action-btn" id="btn-replay-day" onclick="app.playground.toggleDayPlayback()">
                                ‚ñ∂ Replay Day
                            </button>
                        </div>
                        <input type="range" id="day-playback-slider" min="0" max="4" step="1" value="0"
                            oninput="app.playground.handleDeepDiveScrub(this.value)">
                        <div class="scrubber-labels" style="margin-top:0.25rem; font-size:0.7rem; color:#999;">
                            <span>6am</span><span>8am</span><span>10am</span><span>12pm</span><span>2pm</span>
                        </div>
                        <div style="font-size:0.7rem; color:#aaa; margin-top:0.5rem; font-style:normal;">
                            * Analysis of the marine layer burn-off.
                        </div>
                    </div>

                    <!-- Footer: Guidance & Discovery -->
                    <div class="cp-footer" style="margin-top: 1.5rem; padding-top: 0.5rem;">

                        <!-- Dynamic Tip -->
                        <div style="margin-bottom: 0.75rem;">
                            <p id="guidance-text" class="helper-text"
                                style="font-size: 0.8rem; color: #666; margin:0; line-height: 1.3;">
                                Tip: Compare morning vs afternoon results.
                            </p>
                        </div>

                        <!-- Discovery Links (Clean Stack for Stability) -->
                        <div id="quick-find-row"
                            style="display: flex; gap: 1rem; align-items: center; border-top: 1px dotted #eee; padding-top: 0.75rem;">
                            <label
                                style="font-size: 0.7rem; font-weight: 800; color: #444; text-transform: uppercase; min-width: max-content;">Quick
                                Discovery:</label>
                            <div style="display:flex; gap:0.75rem; flex-wrap:wrap;">
                                <a href="#" onclick="event.preventDefault(); app.playground.findExtreme('cloudiest')"
                                    class="text-link"
                                    style="color:#bdc3c7; border-bottom-color:rgba(230, 126, 34, 0.3);">Cloudiest</a>
                                <a href="#" onclick="event.preventDefault(); app.playground.findExtreme('clearest')"
                                    class="text-link"
                                    style="color:#f1c40f; border-bottom-color:rgba(230, 126, 34, 0.3);">Clearest</a>
                                <a href="#" onclick="event.preventDefault(); app.playground.findExtreme('diff')"
                                    class="text-link"
                                    style="color:#e67e22; border-bottom-color:rgba(230, 126, 34, 0.3);">Biggest
                                    Change</a>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </section>



    <!-- BRIDGE 2: PREPARING FOR MECHANISM -->
    <section class="prose-bridge">
        <h2>The Secret Behind the Gray</h2>
        <p>From the above sections, you might have noticed a weird pattern of foggy mornings and sunny afternoons that
            happens during late Spring and early Summer, from mid May to almost the end of August. This persistent
            pattern is most commonly known as <strong>"June Gloom"</strong>, while also has other colloquialisms such as
            <strong>"Graypril"</strong>, <strong>"May Gray"</strong>, <strong>"No-Sky July"</strong>, and
            <strong>"Fogust"</strong>. <br>
            The satellite data shows us
            <em>what</em> it looks like, but to understand <em>why</em> it happens (what's marine layer??), we have to look at the physics.
        </p>
    </section>

    <!-- SECTION 3.5: MECHANISM VIZ -->
    <section id="mechanism-section" class="scrolly-container bg-dark">
        <!-- ... (Mechanism content stays same, just adding ID reference if needed, but ID is already there) ... -->


        <!-- STICKY VIZ -->
        <div class="mech-sticky-stage">
            <div id="mech-canvas-container"></div>

            <!-- Dynamic UI Overlay (Changes by Step) -->
            <div class="mech-overlay-ui">
                <div class="mech-control-deck hidden" id="mech-final-controls">
                    <span class="mech-time">6:00 AM</span>
                    <input type="range" id="mech-scrubber" min="0" max="100" value="0" step="0.5">
                    <span class="mech-time">6:00 PM</span>
                </div>
            </div>
        </div>

        <!-- SCROLLING STEPS -->
        <div class="mech-scroll-text">

            <!-- Step 1: The Normal Atmosphere -->
            <div class="mech-step" data-step="1">
                <div class="mech-card">
                    <h3>1. Normal Air</h3>
                    <p>Usually, air gets cooler as you go higher up. This allows clouds to rise easily and fade away
                        into the atmosphere.</p>
                </div>
            </div>

            <!-- Step 2: The Inversion Lid -->
            <div class="mech-step" data-step="2">
                <div class="mech-card">
                    <h3>2. The Warm Lid</h3>
                    <p>In June, a layer of warm air sits on top of the cool ocean air. This warm layer acts like a cap
                        (or "inversion") that holds the cool, moist air down.</p>
                </div>
            </div>

            <!-- Step 3: The Coastal Trap -->
            <div class="mech-step" data-step="3">
                <div class="mech-card">
                    <h3>3. Trapped Clouds</h3>
                    <p>Cool ocean breezes push clouds inland against the mountains. Because they are stuck beneath the
                        warm air layer, the fog forms a thick sheet over the coast.</p>
                </div>
            </div>

            <!-- Step 4: The Interactive Burn-Off -->
            <div class="mech-step" data-step="4">
                <div class="mech-card">
                    <h3>4. Burning Off</h3>
                    <p>When the sun rises, it warms the ground. This heat mixes the air and causes the fog to evaporate
                        (or "burn off").</p>
                    <p><strong>Try it:</strong> Scrub the slider to clear the marine layer.</p>
                </div>
            </div>

            <div class="mech-step spacer" style="height: 50vh;"></div>

        </div>
    </section>

    <!-- INTRO: PART 2 HEADER -->
    <section id="part2-header" class="part-divider">
        <div class="part-number">02</div>
        <div class="part-content">
            <h2>II. The Climate Projection</h2>
            <p>Now we can use our understanding of the mechanism to project how the gloom will affect the actual "summer"
                weather. We combined our 2023 observational data with <strong>CMIP6 historical climate models</strong>, taking the
                average temperature and solar radiation over 20 years to see how the gloom affects the actual "summer"
                weather.</p>
        </div>
    </section>

    <!-- SECTION 4: CLIMATE LAB -->
    <section id="climate-lab" class="full-screen-section bg-light">
        <div class="section-header">
            <h2>The Seasonality Matrix</h2>
            <p>Comparing the seasonal phases of three key climate variables.</p>
        </div>

        <div class="lab-container panel">
            <!-- Viz -->
            <div class="lab-viz">
                <div id="lab-colorfield"></div>
            </div>

            <!-- Controls -->
            <div class="lab-controls">
                <h3>Variable Layer</h3>
                <div class="var-buttons">
                    <button class="var-btn active" onclick="app.lab.setVariable('clouds')">Cloud Cover</button>
                    <button class="var-btn" onclick="app.lab.setVariable('temp')">Temperature (Air)</button>
                    <button class="var-btn" onclick="app.lab.setVariable('sun')">Solar Radiation</button>
                </div>

                <div class="seasonality-chart">
                    <h3>Annual Trend</h3>
                    <div id="season-sparklines"></div>
                </div>

                <p id="lab-insight" class="lab-insight">
                    Data Insight: Cloud cover peaks in late spring, creating a disconnect with rising solar angles.
                </p>
            </div>
        </div>
    </section>

    <!-- BRIDGE 3 -->
    <section class="prose-bridge">
        <h2>Finding Your Spot</h2>
        <p>These regional averages show the general pattern, but the weather changes drastically depending on where you
            are. We used these <strong>long-term climate averages</strong> to build a ranking model for every city. Use
            the tool below to find the location that matches your specific preferences.</p>
    </section>

    <!-- SECTION 5: SUNNY CITY PLAYGROUND -->
    <section id="city-playground" class="full-screen-section bg-light">
        <!-- Map Visualization (Background) -->
        <div id="city-map-container"></div>

        <div class="city-dashboard">
            <!-- Floating Sidebar -->
            <div class="city-sidebar">
                <div class="sidebar-header">
                    <h2>Location Optimizer</h2>
                    <p>Find the one city that matches your definition of "Good Weather", or just confirm your own bias.
                    </p>
                </div>
                <!-- Search -->
                <div class="search-wrapper">
                    <div class="search-input-box">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="city-search-input" placeholder="Find your city..." autocomplete="off">
                        <button id="search-clear-btn" style="display:none;">‚úï</button>
                    </div>
                    <!-- Custom Dropdown Results -->
                    <ul id="city-search-results" class="search-results-list"></ul>
                </div>

                <div class="city-filters panel">
                    <h3 style="font-size:0.85rem; color:#999; margin-bottom: 1rem;">Preference Weights</h3>

                    <div class="slider-group">
                        <label>Solar Importance <span id="val-sun">50</span></label>
                        <input type="range" min="0" max="100" value="50"
                            oninput="app.cities.updateWeight('sun', this.value)">
                    </div>

                    <div class="slider-group">
                        <label>Cloud Sensitivity <span id="val-cloud">70</span></label>
                        <input type="range" min="0" max="100" value="70"
                            oninput="app.cities.updateWeight('cloud', this.value)">
                    </div>

                    <div class="slider-group">
                        <label>Heat Aversion <span id="val-heat">30</span></label>
                        <input type="range" min="0" max="100" value="30"
                            oninput="app.cities.updateWeight('heat', this.value)">
                    </div>
                </div>

                <div class="city-leaderboard panel">
                    <div class="leaderboard-header">Top Candidates</div>
                    <div id="city-list">
                        <!-- JS Generated -->
                    </div>
                </div>
            </div>
        </div>
    </section>





    <!-- SECTION 6: REAL-TIME CLOUDS -->
    <section id="today-clouds" class="realtime-clouds-section">
        <h2>
            <span class="live-indicator"><span class="live-pulse"></span>LIVE</span>
            Real-time Clouds Over West Coast
            <p>See the latest 4-hour cloud cover conditions in real-time, updated every 30 minutes.</p>
        </h2>

        <div class="cloud-gif-container">
            <img id="psw-loop" alt="GOES-18 GeoColor animated loop for the Pacific Southwest" />
        </div>

        <p class="source-caption">
            GOES-18 GeoColor Satellite Loop (Pacific Southwest Sector) ‚Ä¢ Data courtesy of NOAA NESDIS STAR
        </p>
    </section>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-brand">
                <h3>
                    <span class="strike-through">Sunny</span> Cloudy Socal
                </h3>
                <p class="footer-tagline">Is SoCal really sunny?</p>
                <p>Decoding Southern California's "Sunny" Reputation through Data.</p>
            </div>

            <div class="footer-links">
                <span class="footer-heading">Data Sources</span>
                <ul>
                    <li><a href="https://www.star.nesdis.noaa.gov/GOES/index.php" target="_blank">NOAA GOES-16/18</a>
                    </li>
                    <li><a href="https://www.ipcc.ch/" target="_blank">CMIP6</a>
                    <li><a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a></li>
                    <li><a href="https://www.mapbox.com/" target="_blank">Mapbox</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2023 University of California, San Diego. DSC 106 Final Project.
        </div>
    </footer>

    <!-- LOGIC (JS Modules) -->
    <script src="data/goes_images_index.js"></script>
    <script src="data/real_cloud_data.js"></script>
    <script src="data/data.js"></script>

    <!-- Core Modules -->
    <script src="js/config.js"></script>
    <script src="js/dataset.js"></script>

    <!-- External Data -->
    <script src="data/word_cloud_data.js"></script>

    <!-- Map & Viz Logic -->
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>

    <!-- Component Modules -->
    <script src="js/components/city-ranker.js"></script>
    <script src="js/components/fog-controller.js"></script>
    <script src="js/components/intro-hook.js"></script>
    <script src="js/components/hero-grid.js"></script>
    <script src="js/components/cloud-wall.js?v=2"></script>
    <script src="js/components/cloud-playground.js?v=2"></script>
    <script src="js/components/gloom-scatter.js"></script>
    <script src="js/components/climate-lab.js"></script>
    <script src="js/components/gloom-scatter.js"></script>
    <script src="js/components/climate-lab.js"></script>
    <script src="js/components/mechanism.js"></script>
    <script src="js/components/realtime_clouds.js"></script>
    <script src="js/components/navigator.js?v=2"></script>
    <script src="js/sections/intro.js?v=2"></script>


    <!-- Main Initialization -->
    <script src="js/app.js"></script>
</body>

</html>